% Pour plus tard:
% Supprimer la rétrocompatibilité, ce sera plus lisible...
% Utiliser des tcbox à la place des colorbox? marges plus personnalisables (style fbox pour avoir comme colorbox)

% Liste des packages utilisés
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\usepackage{lipsum}
\usepackage[a4paper,margin=15mm,marginparwidth=15mm,marginparsep=0mm]{geometry} %Papier, marges
\usepackage[french]{babel}	% Langue
\usepackage[utf8]{inputenc}
\usepackage[T1]{fontenc}
\usepackage{amsfonts,amssymb,amsmath}	% Symboles maths... (indispensable)
\usepackage{stmaryrd} 					% pour \llbracket
%\usepackage{fourier-otf}				% Police d'écriture
\usepackage[explicit]{titlesec}
\usepackage{setspace}
\usepackage{dsfont}
\usepackage{tabularx,tabulary}			% Tableaux avec taille définie
\usepackage{mathrsfs}
\usepackage{marginnote}
\usepackage[svgnames,rgb,dvipsnames]{xcolor}
\usepackage{graphicx}
\usepackage[thref,framed,thmmarks]{ntheorem}	% Alternative à amsthm
\usepackage[most]{tcolorbox}			% Boites évoluées
\usepackage{framed}
\usepackage{comment}
\usepackage{ragged2e}
\usepackage{microtype}					% Améliore le rendu final
\usepackage{ifthen}						% Pour la définition de macros: conditions
\usepackage{multicol}					% Pour scinder des documents en plusieurs colonnes. Alternative à l'option twocolumn
\usepackage{enumitem}					% Enumérations évoluées
\usepackage{cancel}
\usepackage{diagbox}
\usepackage{fancyhdr}					% Entêtes
\usepackage{eurosym}					% Symbole euro
\usepackage{icomma}						% Pour l'espacement des virgules en mode math
\usepackage{xstring}
\usepackage{etoolbox}					% Plein d'outils pour créer des macros
\usepackage{xpatch}						% Pour modifier une macro déjà existante: chercher-remplacer
\usepackage[d]{esvect} 					% Meilleurs vecteurs - Problèmess avec polices non otf
\usepackage{lastpage}					% Trouve le numéro de la dernière page
%\usepackage[pdfauthor={Virgil Delauney}]{hyperref}

\usepackage{tikz}
\usetikzlibrary{shapes,arrows.meta,calc}
\usepackage{pgfplots}					% Graphes de fonctions
\usepackage{tkz-tab}					% Tableaux de variations/signe

\usepackage[french,linesnumbered,vlined]{algorithm2e} % Algorithmes

% Abréviations displaystyle 
\newcommand{\Int} {\displaystyle \int}

% Abréviations maths
\newcommand{\C} {\mathbb{C}}
\newcommand{\R} {\mathbb{R}}
\newcommand{\Z} {\mathbb{Z}}
\newcommand{\N} {\mathbb{N}}
\newcommand{\K} {\mathbb K}
\newcommand{\U} {\mathbb U}
\newcommand{\D} {\mathbb D}
\newcommand{\Q} {\mathbb Q}
\newcommand{\Pro} {\mathbb P}
\newcommand{\Esp} {\mathbb E}

\newcommand{\fonction}[5]{\begin{array}[t]{ccccc}
#1: & #2 & \longrightarrow & #3 \\
    & #4 & \longmapsto & #5 \end{array}}
\newcommand{\fonctionb}[4]{\begin{array}[t]{ccccc}
#1 & \longrightarrow & #2 \\
#3 & \longmapsto & #4 \end{array}}
\newcommand{\fonct}[3]{#1: #2 \longmapsto #3}

\newcommand{\abs}[1]{\left\vert #1 \right\vert}

\let\vec\vv		% Redéfinitions pour utiliser le package esvect dans tous les cas
\let\vecc\vv

\newcommand{\Oij}{$\left(\text{O},~\vec{i},~\vec{j}\right)$}
%\newcommand{\vecc}[1] {\overrightarrow{#1}}

% Gras dans titres en mode math

\g@addto@macro\bfseries{\boldmath}
\SetSymbolFont{stmry}{bold}{U}{stmry}{m}{n}

% Commandes cours
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\author{}
\date{}

\newcommand{\titre}[1]{\begin{center}{\fontfamily{cmr}\fontseries{bx}\selectfont \huge{#1}}\end{center}}

\newcommand{\seconde}{2\textsuperscript{nde}}
\newcommand{\premiere}{1\textsuperscript{ère}}

\newcommand{\fakeitem}{\textemdash \ }

% Compo

\newlength{\colG}\newlength{\colD}

\newlength{\tailletexte}
\setlength{\tailletexte}{\f@size pt}
\newlength{\composep}
\setlength{\composep}{10pt}

\newcommand{\fixcompo}{\noindent\vphantom{\rule{0pt}{\baselinestretch\tailletexte}}} %Pour corriger les bugs d'espacement entre le titre ou la suite, je n'ai pas encore réussi à automatiser ça... - Utiliser strut à la place

\newif\ifincompohaut
\incompohautfalse

\newcommand{\compobase}[5]{\ifthenelse{\equal{#2}{t}}{\incompohauttrue}{}%
\setlength{\colG}{#3\linewidth}\setlength{\colD}{\linewidth}%
\addtolength{\colD}{-\colG}\addtolength{\colD}{-#1}%
\addtolength{\colG}{-#1}%
\par\noindent%
\begin{minipage}[#2]{\colG}\vspace{0pt}%
#4\end{minipage}\hfill%	%vspace=hack pour des problèmes d'alignement qui aparaissent avec compohaut
\begin{minipage}[#2]{\colD}\vspace{0pt}%
#5\end{minipage}\incompohautfalse\par}


\newcommand{\compo}[3][0.5]{\compobase{\composep}{c}{#1}{#2}{#3}}
\newcommand{\compohaut}[3][0.5]{\compobase{\composep}{t}{#1}{#2}{#3}}

% Compo avec ligne séparatrice

\newlength{\hauteurGauche} \newlength{\hauteurDroite} \newlength{\decalageLigne}
\newsavebox{\partieGauche} \newsavebox{\partieDroite}

\newcommand{\compolignebase}[5]{
\setlength{\colG}{#3\linewidth}\setlength{\colD}{\linewidth}%
\addtolength{\colD}{-\colG}\addtolength{\colD}{-#1}%
\addtolength{\colG}{-#1}%
\sbox{\partieGauche}{\begin{minipage}[#2]{\colG}\vspace{0pt}#4\end{minipage}}%
\sbox{\partieDroite}{\begin{minipage}[#2]{\colD}\vspace{0pt}#5\end{minipage}}%
\setlength{\hauteurGauche}{\ht\partieGauche} \setlength{\hauteurDroite}{\ht\partieDroite}%
\addtolength{\hauteurGauche}{\dp\partieGauche} \addtolength{\hauteurGauche}{14pt}%
\addtolength{\hauteurDroite}{\dp\partieDroite} \addtolength{\hauteurDroite}{14pt}%
\par\noindent%
\usebox{\partieGauche}%
\setlength{\decalageLigne}{7pt}%
\ifthenelse{\lengthtest{\hauteurGauche>\hauteurDroite}}%
{\addtolength{\decalageLigne}{\dp\partieGauche} \hfill \rule[-\decalageLigne]{0.5pt}{\hauteurGauche} \hfill}%
{\addtolength{\decalageLigne}{\dp\partieDroite} \hfill \rule[-\decalageLigne]{0.5pt}{\hauteurDroite} \hfill}%
\usebox{\partieDroite}%
\par
}

\newcommand{\compoligne}[3][0.5]{\compolignebase{\composep}{c}{#1}{#2}{#3}}
\newcommand{\compolignehaut}[3][0.5]{\compolignebase{\composep}{t}{#1}{#2}{#3}}

% Environnement centrer sans passage à la ligne

\newenvironment{centrer}{\par \centering }{ \par}

% Remarques (avec compatibilité)
% A refaire entièrement: problème avec options définies avant d'où les ifthenelse à foison

\colorlet{couleurrem}{DarkGreen}

\newcommand{\rembase}[1] {\begin{center} \color{couleurrem}\textit{#1} \end{center}}
\newcommand{\remmbase}[1] {\rem{#1}} % A supprimer quand je serai sûr que ca n'est plus utilisé

\newcommand{\rem}[2][]{\ifthenelse{\equal{#1}{black}}{\colorlet{couleurrem}{black}}{}\rembase{#2}\colorlet{couleurrem}{DarkGreen}} % Pour pouvoir utiliser l'option eleve sur les remarques plus tard. Option If pour compatibilité ...

% Commandes sujets
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

% Lignes de points pour réponses, à modifier:
% Si uniquement des points dans un compo, utiliser pointsfixcompo
% Si points après un compo, utiliser \fixcompo\points pour éviter l'espacement après
% Renommer pointsfixincompo // pointsfixaprescompo ?
% \strut marche bien en fait
% SI compohaut, le strut casse un peu l'espacement. Condition pour voir si on est dans cet environnement pour annuler le strut

\newlength{\enumitemindent} %Pour que les points soient sur toute la page. A voir en compo, le résultat semble ok car la minipage subit la marge
\setlength{\enumitemindent}{0pt}
\newcommand{\pointstretch}{1.5}
\setlist{before={\addtolength{\enumitemindent}{\leftmargin}},after={\addtolength{\enumitemindent}{-\leftmargin}},font=\bfseries}% Mise à jour de la marge, addtolength ou setlength... (reculer d'une indentation ou de toutes) + mode bf (obligé de tout faire en même temps)
%pointsfixcompo a supprimer, le strut marche plutôt bien. espace vertical trop faible peut-être... Marche pas bien en compohaut, faire fonction distrinction de cas?
\newcommand{\points}[2][\pointstretch]{\setstretch{#1}%
\foreach \n in{1,...,#2}%
{\noindent\hspace{-\enumitemindent}\ifincompohaut\else\strut\fi\dotfill

}
}

\newcommand{\pointsfixcompo}[2][\pointstretch]{\setstretch{#1}% Pour ajouter un espacement si necessaire, dans ou après un compo.
\fixcompo%
\foreach \n in{1,...,#2}%
{\noindent\hspace{-\enumitemindent}\ifthenelse{\equal{\n}{#2}}{\vphantom{\rule[-\baselinestretch\tailletexte]{0pt}{\baselinestretch\tailletexte}}}{}\dotfill

}
}

% Entete pour interros ( quand il en faut plusieurs en une page, imitation fancyhdr )

\newcommand{\entete}[3]{
\begin{centrer}
\par\smallskip\noindent\parbox[t]{.149\textwidth}{\raggedright #1}%
\parbox[t]{.7\textwidth}{\centering #2}%
\parbox[t]{.149\textwidth}{\raggedleft #3}%

\rule[3.3mm]{\textwidth}{0.4pt}
\end{centrer}
}

% Centrer tabularx de base et ligne centrée Y

\renewcommand\tabularxcolumn[1]{m{#1}}
\newcommand{\tabularxgauche}{\renewcommand\tabularxcolumn[1]{p{##1}}}
\newcommand{\tabularxcentrer}{\renewcommand\tabularxcolumn[1]{m{##1}}}
\newcolumntype{Y}{>{\centering\arraybackslash}X}

% Initialisation pgfplots, tikz et styles
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\newcommand{\echellepgf} {4/5}
\newcommand{\echellepgfinv} {5/4}

\pgfplotsset{ % Pas besoin de "styleglobal" en fait ... Important: ne pas faire xscale mais x post scale pour conserver la taille des ticks
compat=1.18,
styleglobal/.style={
height=\pgfkeysvalueof{/pgfplots/width}*(((\pgfkeysvalueof{/pgfplots/ymax})+((-1)*(\pgfkeysvalueof{/pgfplots/ymin})))/((\pgfkeysvalueof{/pgfplots/xmax})+((-1)*(\pgfkeysvalueof{/pgfplots/xmin}))))+0.1pt, %Hauteur auto en fonction des coordonnées et de l'échelle
axis x line=bottom,
axis y line = left,
axis lines=middle,
axis line style={-{Stealth}}, %Plus grosse flèche
tick label style = {font=\footnotesize},
scale only axis, %Pour bien tomber sur la grille
xlabel={$x$},
ylabel={$y$},
label style= {font=\scriptsize},
minor x tick num=1, %Sous graduations
minor y tick num=1,
%xtick distance=1, %Graduations
%ytick distance=1,
enlargelimits={0.001},
grid=both,
grid style={densely dashed,line width=0.4pt,draw=black!30},
minor grid style={line width=0.25pt,draw=black!20},
axis equal,
legend pos=north east,
domain=(\pgfkeysvalueof{/pgfplots/xmin}:\pgfkeysvalueof{/pgfplots/xmax}),
},
styleplot/.style={
samples=101,
smooth,
line width=1.3pt,
mark=none
},
labelgros/.style={
label style= {font=\large},
tick label style = {font=\large}
},
hauteurproptick/.style={
height=\pgfkeysvalueof{/pgfplots/width}*((\pgfkeysvalueof{/pgfplots/xtick distance}/\pgfkeysvalueof{/pgfplots/ytick distance})*((\pgfkeysvalueof{/pgfplots/ymax})+((-1)*(\pgfkeysvalueof{/pgfplots/ymin})))/((\pgfkeysvalueof{/pgfplots/xmax})+((-1)*(\pgfkeysvalueof{/pgfplots/xmin})))),
axis equal=false,
enlargelimits=0.001,
}
}

\pgfkeys{/pgf/number format/use comma,/pgf/number format/.cd,1000 sep={\,}}

\newcommand{\pointsextremites}{node[pos=0,circle,minimum size=1pt,fill,inner sep=1pt,fill opacity=1] {} node[pos=1,circle,minimum size=1pt,fill,inner sep=1pt,fill opacity=1] {}}

\tikzset{
stylepoint/.style={
	draw=black,
	color=black,
	circle,
	minimum size=1pt,
	fill,
	inner sep=2pt,
	fill opacity=1
},
}

%\raggedcolumns
%\setlength{\columnsep}{1cm}
%\setlength{\columnseprule}{0.2pt}
%\everymath{\displaystyle}

%\setlist[itemize]{align=parleft,left=5pt..15pt}
%\setlist[enumerate]{align=parleft,left=5pt..20pt}


% Test tcolorbox
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%Mise à jour dynamique de la couleur de fond
%Au lieu d'utiliser des options de transparence on pourra utiliser des couleurs comme red!10!bg ( 10% de rouge sur un fond de couleur bg )
%Voir cours ensembles de nombres pour un exemple d'utilisation

\colorlet{bg}{white}

% Mise à jour dynamique de la couleur de textbf

\colorlet{bfcolor}{black}
\newcommand{\colorfadebg}{15}
\tcbset{
	frame hidden,
	boxrule=0pt,
	boxsep=0pt,
	enlarge bottom by=0pt,
	enhanced jigsaw,
	boxed title style={sharp corners,boxrule=0pt,coltitle={white},titlerule=0pt},
	fonttitle=\bfseries\boldmath,
	top=10pt,
	right=10pt,
	bottom=10pt,
	left=10pt,
	sharp corners,
}

\newcommand{\deftcbUn}[6][10]{
\definecolor{#2-titre}{Hsb}{#4,#5,#6}
\colorlet{#2}{#2-titre!#1}
\newtcolorbox{#2}[1][]{
	colback=#2,
	breakable,
	borderline west={1pt}{0pt}{#2-titre},
	title={\hspace{-10pt}\colorbox{#2-titre}{\hspace{7pt}\rule[-3pt]{0pt}{14.3pt}\MakeUppercase{#3}\ifstrempty{##1}{}{ (##1)}\hspace{7pt}}},
	colbacktitle=#2,
	before upper={\colorlet{bg}{#2} \definecolor{bfcolor}{Hsb}{#4,0.75,0.15}},
	after upper={\colorlet{bg}{white} \colorlet{bfcolor}{black}},
	%before upper={\tcolorboxsubtitle{#1}{##1}},
}
}

% Test pour le titre:
%\tcbox[size=fbox,left=7pt,right=7pt,colback=defin-titre,height=1cm,valign=center]{\color{white}\MakeUppercase{\bfseries\boldmath Définition Propriété Vocabulaire}}
% Voir raisebox!

\newcommand{\deftcb}[6][10]{ % Pour définir tous les types de thm en une ligne: voir options
\deftcbUn[#1]{#2}{#3}{#4}{#5}{#6}
\deftcbUn[#1]{#2s}{#3s}{#4}{#5}{#6}
}

\definecolor{remq-titre}{Hsb}{50,0.8,0.8}
\colorlet{remq}{remq-titre!10}
\newtcolorbox{remq}{
	colback=remq,
	colframe=remq-titre,
	hbox,
	flush right,
	right=4pt,
	left=4pt,
	top=7pt,
	bottom=7pt,
	borderline west={2pt}{-2pt}{remq-titre},
	%title={\hspace{-10pt}\colorbox{rmq-perso-titre}{\rule[-3pt]{0pt}{14pt} \hspace{5pt}\MakeUppercase{#3}\ifstrempty{##1}{}{ (##1) }\hspace{10pt}}},
	%colbacktitle=#2,
	before upper={\colorlet{bg}{remq} \definecolor{bfcolor}{Hsb}{50,0.75,0.15}},
	after upper={\colorlet{bg}{white} \colorlet{bfcolor}{black}},
	%before upper={\tcolorboxsubtitle{#1}{##1}},
}

%\definecolor{programme-titre}{Hsb}{0,0.8,0.75}
%\colorlet{programme}{programme-titre!10}
%\newtcolorbox{tcolor-programme}{
%	colback=programme,
%	borderline west={1pt}{0pt}{programme-titre},
%	title={\hspace{-10pt}\colorbox{programme-titre}{\rule[-3pt]{0pt}{14pt} \hspace{5pt}\MakeUppercase{Programme}\hspace{10pt}}},
%	colbacktitle=programme,
%	before upper={\colorlet{bg}{programme} \definecolor{bfcolor}{Hsb}{0,0.75,0.15}},
%	after upper={\colorlet{bg}{white} \colorlet{bfcolor}{black}},
%	%before upper={\tcolorboxsubtitle{#1}{##1}},
%}
%
%\definecolor{deroule-titre}{Hsb}{0,0.8,0.75}
%\colorlet{deroule}{deroule-titre!10}
%\newtcolorbox{tcolor-deroule}{
%	colback=deroule,
%	borderline west={1pt}{0pt}{deroule-titre},
%	title={\hspace{-10pt}\colorbox{deroule-titre}{\rule[-3pt]{0pt}{14pt} \hspace{5pt}\MakeUppercase{Déroulé}\hspace{10pt}}},
%	colbacktitle=deroule,
%	before upper={\colorlet{bg}{deroule} \definecolor{bfcolor}{Hsb}{0,0.75,0.15}},
%	after upper={\colorlet{bg}{white} \colorlet{bfcolor}{black}},
%	%before upper={\tcolorboxsubtitle{#1}{##1}},
%}

\definecolor{fait-titre}{Hsb}{0,0,0.6} % Quand un résultat n'est pas vraiment catégorisé: intro d'une partie...
\colorlet{fait}{fait-titre!10}
\newtcolorbox{fait}[1][fait]{ % Option = couleur à prendre ( mettre nom de thm )
    top=5pt,
    bottom=5pt,
	colback={#1},
	borderline west={1pt}{0pt}{#1-titre},
}

\newcounter{compteurenonce}   % Pour des noms d'énoncés rares, a voir selon option cours

% Redéfinitions tableaux de signes
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

% Note: makeatletter / makeatother inutile dans un sty ou cls

\def\tkzTabDefaultBackgroundColor{bg}

% Changement style ligne pour zéros, prendre tout le bloc avec xpatch ne marche pas donc solution un peu moche mais fonctionnelle

\xpatchcmd{\tkzTabLine}
{
\ifthenelse{\equal{\expandafter\stripspaces\expandafter{\x}}{z}}%
}
{
\ifthenelse{\equal{\expandafter\stripspaces\expandafter{\x}}{z}}{\tikzset{t style/.append style = { style = solid }}}{}
\ifthenelse{\equal{\expandafter\stripspaces\expandafter{\x}}{z}}
}
{}{}

%\tikzset{t style/.style={style=densely dotted,draw=\tkzTabDefaultWritingColor}}

\xpatchcmd{\tkzTabLine}
{
\node at (Z\thetkz@cnt@impair\thetkz@cnt@lg){$0$}; 
} % search
{
\node[fill=black,line width=0.5pt,draw=black,circle,minimum size=7pt,inner sep=2pt,xscale=0.93,yscale=1.3] at (Z\thetkz@cnt@impair\thetkz@cnt@lg){};
\node[fill=\tkzTabDefaultBackgroundColor,line width=0.5pt,draw=\tkzTabDefaultBackgroundColor,circle,minimum size=7pt,inner sep=2pt,xscale=0.7,yscale=1.18] at (Z\thetkz@cnt@impair\thetkz@cnt@lg){};
\tikzset{t style/.style = {style      = \cmdTAB@TTS@tstyle,
                           draw       = \cmdTAB@TTS@tcolor,
                           line width = \cmdTAB@TTS@twidth}} % Bizaremment, ça remet à zéro tout seul le style donc ligne inutile ...
}  % replace
{}{}

% Augmentation espacement pour double ligne

\tikzset{double style/.append style = {double distance=1pt}}


%%% Algorithmique
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%


% algoption nécessaire: Dans multicol il faut un H mais il est interdit en twocolumn ...

\newcommand{\algoption}{H}
\AtBeginEnvironment{multicols}{\renewcommand{\algoption}{H}}
\AtBeginEnvironment{multicols*}{\renewcommand{\algoption}{H}}

\setlength\columnsep{20pt}
\newcounter{algonum}
\SetKwInput{debutalgofix}{\rule[-7pt]{0pt}{5pt} \addtocounter{algonum}{1} \ \ \normalfont{\underline{Algorithme \thealgonum}}}
\SetKwInput{debutalgofixetoile}{\rule[-7pt]{0pt}{5pt} \ \ \normalfont{\underline{Algorithme}}}
\SetKwProg{algofonction}{Procédure}{:}{}
\SetArgSty{normalfont}
\renewcommand{\emph}[1]{#1}
\newenvironment{algorithme}
{
\vspace{5pt}
\begin{algorithm}[\algoption]
	\debutalgofix
	
}
{
\end{algorithm}
}

\SetAlgoSkip{5pt}

\newenvironment{algorithme*}
{
\vspace{5pt}
\begin{algorithm}[\algoption]
	\debutalgofixetoile
	
}
{
\end{algorithm}
}

%%% Option progres
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

% Le but est d'ignorer tout ce qui vient après la commande dans le fichier cours pour pouvoir avoir des cours partiels. La commande prend son sens avec l'option eleve.
\newcommand{\progres}{}

% Options
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

% C'est un peu bordélique ici:
%Si on a l'option cours, tous les thm apparaissent dans des tcolorbox. Sinon on utilise ntheorem
%Si on a l'option élève, on doit désactiver la commande rem sauf si option eleve dans la remarque( remarques perso dans le cours ), on a besoin de tester si elle est présente pour faire un si-sinon

%
%	Si cours alors boites tcolorbox
%	Sinon
%	Définir styles ntheorem classiques
%		Si option TD alors style exo mixte et marges modifiées
%		Si sujet alors pareil sans style exo mixte
%	Si eleve alors désactiver les rmq perso sauf cas particuliers
%

\newif\ifoptioncours
\optioncoursfalse

\newif\ifoptioneleve
\optionelevefalse

\newif\ifoptionTD
\optionTDfalse

\newif\ifoptionsujet
\optionsujetfalse

\newif\ifoptionsujetOuTD
\optionsujetOuTDfalse

\newif\ifoptionNB
\optionNBfalse

\newif\ifoptionminted
\optionmintedfalse

\DeclareOption{cours}{\optioncourstrue}

\DeclareOption{eleve}{\optionelevetrue}

\DeclareOption{TD}{\optionTDtrue\optionsujetOuTDtrue}

\DeclareOption{sujet}{\optionsujettrue\optionsujetOuTDtrue}

\DeclareOption{NB}{\optionNBtrue}

\DeclareOption{minted}{
	\optionmintedtrue
}

\DeclareOption{coursInline}{
	\renewcommand{\baselinestretch}{1.1}
	\tcbset{
		rounded corners=southwest,
		arc=5pt,
		auto outer arc,
		styletitre/.style={
			sharp corners,
			boxrule=0pt,
			%boxsep=0pt,
			enlarge bottom by=2pt,
			enhanced jigsaw,
			on line,
			top=0pt,
			bottom=0pt,
			right=0mm,
			left=3pt,
		},
	}
	\renewcommand{\deftcbUn}[6][10]{
	\definecolor{#2-titre}{Hsb}{#4,#5,#6}
	\colorlet{#2}{#2-titre!#1}
	\newtcolorbox{#2}[1][]{
		colback=#2,
		title={},
		colbacktitle=#2,
		top=0pt,
		bottom=5pt,
		enlarge bottom by=0pt,
		%borderline west={1pt}{0pt}{#2-titre},
		before upper={\colorlet{bg}{#2}\definecolor{bfcolor}{Hsb}{#4,0.75,0.15}\hspace{-10pt}\tcbox[styletitre,colback=#2-titre]{\rule[-3pt]{0pt}{14.3pt}{\color{white}\bfseries\MakeUppercase{#3}\ifstrempty{##1}{}{ (##1)} :}}\ },
		after upper={\colorlet{bg}{white} \colorlet{bfcolor}{black}},
	}
	}
}

\ProcessOptions

\ifoptioncours
	
	% Formats titres, sections
	
	\definecolor{titre}{HTML}{912c21}
	\definecolor{section}{HTML}{1c567d}
	\definecolor{subsection}{HTML}{2673a6}
	\definecolor{subsubsection}{HTML}{2f90d0}

	\renewcommand{\thesection}{\Roman{section} - }
	\renewcommand{\thesubsection}{\arabic{subsection}. }
	\renewcommand{\thesubsubsection}{\alph{subsubsection}) }

	\newcommand{\sectionstyle}{\normalfont\Large\bfseries\color{section}}
	\titleformat{\section}{\sectionstyle}{\thesection #1}{0pt}{}[{\color{gray}\hrule}]
	\titleformat{name=\section, numberless}{\sectionstyle}{#1}{0pt}{}[{\color{gray}\hrule}]

	\newcommand{\subsectionstyle}{\normalfont\large\bfseries\color{subsection}}
	\titleformat{\subsection}{\subsectionstyle}{\hspace{0.1\linewidth}\thesubsection #1}{0pt}{}
	\titleformat{name=\subsection, numberless}{\subsectionstyle}{\hspace{0.1\linewidth}#1}{0pt}{}
	
	\newcommand{\subsubsectionstyle}{\normalfont\large\bfseries\color{subsubsection}}
	\titleformat{\subsubsection}{\subsubsectionstyle}{\hspace{0.2\linewidth}\thesubsubsection #1}{0pt}{}
	\titleformat{name=\subsubsection, numberless}{\subsubsectionstyle}{\hspace{0.2\linewidth}#1}{0pt}{}
	
	\def\@maketitle{\centering  \let \footnote \thanks {\fontfamily{cmr}\fontseries{bx}\selectfont\huge\scshape\color{titre} \@title \par}%
	\textcolor{darkgray}{\hrule}%
	\vspace{2pt}%
	\textcolor{darkgray}{\hrule height 2pt depth 0pt \relax}%
  \par
  \vskip 2em}
  
  	% Si fourier-otf, retirer le changement de police+Huge+enlever bf

	\renewcommand{\titre}[1]{\title{#1} \maketitle}
	
	% Template: \deftcb{identifiant}{Nom}{Teinte}{Saturation}{Luminosité} ( Modèle HSB )
	\deftcb{defin}{Définition}{211}{0.8}{0.75}
	\deftcb{thm}{Théorème}{0}{0.8}{0.75}
	\deftcb{prop}{Proposition}{15}{0.8}{0.75}
	\deftcb[8]{ex}{Exemple}{120}{0.8}{0.58}
	\deftcb[8]{cex}{Contre-exemple}{120}{0.8}{0.58}
	\deftcb{rmq}{Remarque}{211}{0.8}{0.75}
	\deftcb{caspart}{Cas particulier}{211}{0.8}{0.75}
	\deftcb{cor}{Corollaire}{211}{0.8}{0.75}
	\deftcb{app}{Application}{211}{0.8}{0.75}
	\deftcb{propr}{Propriété}{211}{0.8}{0.75}
	\deftcb{methode}{Méthode}{211}{0.8}{0.75}
	\deftcb{exercice}{Exercice}{210}{0.6}{0.7}
	

	\newenvironment{enonce}[1]{
	\deftcbUn{enonce\thecompteurenonce}{#1}{211}{0.8}{0.75}
	\begin{enonce\thecompteurenonce}}
	{\end{enonce\thecompteurenonce} \refstepcounter{compteurenonce}}
	
	\deftcbUn{tcolor-programme}{Programme}{0}{0.8}{0.75}	
	\deftcbUn{tcolor-deroule}{Déroulé}{0}{0.8}{0.75}
	
	\NewDocumentEnvironment{programme}{b}{\vspace{-2em}\begin{tcolor-programme}\saut\setstretch{0.75}{\footnotesize{\begin{itemize}[align=left,leftmargin=8pt,labelwidth=10pt,itemindent=10pt]#1\end{itemize}}}\end{tcolor-programme}}{\par}
	\NewDocumentEnvironment{deroule}{b}{\begin{tcolor-deroule}\saut\setstretch{0.75}{\footnotesize{\begin{itemize}[align=left,leftmargin=8pt,labelwidth=10pt,itemindent=10pt]#1\end{itemize}}}\end{tcolor-deroule}}{\par}
	
	%Les tcolorbox avec titre font un saut automatique mais pas les thm donc saut fait le lien
	\newcommand{\saut}{}
	
	\renewcommand{\textbf}[1]{{\color{bfcolor}\TextOrMath{{\bfseries #1}}{\mathbf{#1}}}}
	
	\renewcommand{\rembase}[1]{\begin{remq} \begin{tabulary}{0.5\linewidth}{>{$\blacktriangleright$ \ }L} #1 \end{tabulary} \end{remq}}
	\NewDocumentEnvironment{remsbase}{b}{\begin{remq} \begin{tabulary}{0.5\linewidth}{>{$\blacktriangleright$ \ }L} #1 \end{tabulary} \end{remq}}{\par}	
	
	\renewcommand{\rem}[2][]{\rembase{#2}}
	\NewDocumentEnvironment{rems}{ob}{\begin{remsbase}#2\end{remsbase}}{\par}
			

\else % Style +- à l'ancienne

	% Style des sections

	\renewcommand{\thesection}{\Roman{section} - \hspace{-2ex}}
	\renewcommand{\thesubsection}{\arabic{subsection}) \hspace{-2ex}}
	\renewcommand{\thesubsubsection}{\alph{subsubsection}) \hspace{-2ex}}

	\titlespacing*{\section}{0mm}{0mm}{1mm}
	\titlespacing*{\subsection}{10mm}{0mm}{3mm}
	\titlespacing*{\subsubsection}{20mm}{0mm}{3mm}

	\def\@maketitle{\centering  \let \footnote \thanks {\huge \@title \par}\par\vskip 2em}
	\NewDocumentEnvironment{programme}{b}{\section*{Programme}\setstretch{0.75}{\footnotesize{\begin{itemize}#1\end{itemize}}}}{\par}
	\NewDocumentEnvironment{deroule}{b}{\section*{Déroulé}\setstretch{0.75}{\footnotesize{\begin{itemize}#1\end{itemize}}}}{\par}
	
	\renewenvironment{fait}[1][]{}{}
	
	\everymath{\displaystyle}
	% Style général
	
	\theorembodyfont{\normalfont}
	\theoremframepostskip{0mm}
	\theoremframepreskip{0mm}
	\theoreminframepostskip{0mm}
	\theoreminframepreskip{0mm}
	\theoremnumbering{arabic}
	
	\ifoptionTD
	
		\geometry{margin=10mm, bottom=17mm}
		\setlength\columnsep{10pt}
		
		\renewcommand{\titre}[1]{\begin{center}{\fontfamily{cmr}\fontseries{bx}\selectfont\huge{#1}}\end{center}}
		%\color[HTML]{682018}
		
	\fi
	
	\ifoptionsujet
		
		
		%\geometry{includeheadfoot,bottom=12.5mm,top=1.5mm} %7mm en A3
		\pagestyle{fancy}
		\setlength{\headheight}{10mm}
		\fancyfoot[C]{Page \thepage /\pageref{LastPage}}
		\setlength\columnsep{3cm}
		\geometry{margin=15mm,top=16mm,headsep=4.5mm,footskip=8.5mm} %Sans includeheadfoot donc il faut mettre cette commande après fancy
		
		
		\AtBeginDocument{
  			\label{FirstPage}
  			\ifthenelse{\equal{\pageref{FirstPage}}{\pageref{LastPage}}}{\fancyfoot[C]{}}{}
		}
	
	\else
	
		% Pagestyle empty si une seule page ou document avec \contenu
		\AtBeginDocument{
  			\label{FirstPage}
  			\ifthenelse{\equal{\pageref{FirstPage}}{\pageref{LastPage}}}{\pagestyle{empty}}{}
  			\ifdef{\contenu}{\pagestyle{empty}}{} % Il faut mettre \contenu avant le begin document, ce n'est pas parfait...
  			\ifdef{\contenua}{\pagestyle{empty}}{}
		} 

	
	\fi	
	
	\ifoptionsujetOuTD		
		
		\colorlet{couleurrem}{black}
		
		%Listes
		
		\setlist[itemize]{align=parleft,left=5pt..15pt}
		\setlist[enumerate]{align=left,left=-3pt..15pt,leftmargin=0pt,itemindent=15pt}
		\setlist[enumerate,1]{align=left,left=5pt..20pt,itemindent=*}
		\setlist[enumerate,2]{align=left,left=5pt..20pt,itemindent=*}	
	
		% Style exos				
		
		\definecolor{couleurExo}{Hsb}{211,0.8,0.65}
		\newtheoremstyle{stylexo}	%Base plain
		{\item[\theorem@headerfont\hskip\labelsep\colorbox{couleurExo}{\color{white}\theorem@headerfont ##1\ ##2\theorem@separator}]}%
		{\item[\theorem@headerfont\hskip \labelsep\colorbox{couleurExo}{\color{white}\theorem@headerfont ##1\ ##2\IfBeginWith{##3}{*}{##3}{\ (##3)}\theorem@separator}]}
		
		\theoremstyle{stylexo}
		\theoremseparator{.}
		\theorempreskip{\topsep}
		\theorempostskip{\topsep}
		\newtheorem{exercice}{Exercice}
		
		\newtheoremstyle{stylecorrection}	%Base plain
		{\item[\theorem@headerfont\hskip\labelsep\colorbox{couleurExo}{\color{white}\theorem@headerfont ##1\theorem@separator}]}%
		{\item[\theorem@headerfont\hskip \labelsep\colorbox{couleurExo}{\color{white}\theorem@headerfont ##1\IfBeginWith{##3}{*}{##3}{\ (##3)}\theorem@separator}]}
		
		\theoremstyle{stylecorrection}
		\theoremseparator{.}
		\theorempreskip{\topsep}
		\theorempostskip{\topsep}
		\newtheorem{correction}{Correction}
		
		\definecolor{couleurDefinTD}{Hsb}{15,0.8,0.65}
		\newtheoremstyle{styledefintd}	%Base plain
		{\item[\theorem@headerfont\hskip\labelsep\colorbox{couleurDefinTD}{\color{white}\theorem@headerfont ##1\theorem@separator}]}%
		{\item[\theorem@headerfont\hskip \labelsep\colorbox{couleurDefinTD}{\color{white}\theorem@headerfont ##1\ (##3) \theorem@separator}]}
		
	\theoremstyle{styledefintd}
		
	\else
	
		\theoremstyle{plain}
		\theoremseparator{.}
		\theorempreskip{\topsep}
		\theorempostskip{\topsep}
		\newtheorem{exercice}{Exercice}
		
		\theoremstyle{nonumberplain}
	
	\fi
	
	\ifoptionNB
	
		\definecolor{couleurExo}{Hsb}{0,0,0.25}
		%\newcommand{\NB}{ NB}
		
	\else
	
		%\newcommand{\NB}{}
		
	\fi	
	
	% Style théorèmes
	
	\theorembodyfont{\normalfont}
	%\theorempostskip{2mm}
	%\theorempreskip{2mm}
	\theoremseparator{ :\par}
	%\theoremsymbol{\rule{1.5mm}{1.5mm}}
	
	\newtheorem{defin}{Définition}
	\newtheorem{thm}[defin]{Théorème}
	\newtheorem{prop}[defin]{Proposition}
	\newtheorem{lemme}[defin]{Lemme}
	\newtheorem{ex}[defin]{Exemple}
	\newtheorem{exs}[defin]{Exemples}
	\newtheorem{cex}[defin]{Contre-exemple}
	\newtheorem{rmq}[defin]{Remarque}
	\newtheorem{rmqs}[defin]{Remarques}
	\newtheorem{cor}[defin]{Corollaire}
	\newtheorem{propr}[defin]{Propriété}
	\newtheorem{proprs}[defin]{Propriétés}
	\newtheorem{app}[defin]{Application}
	\newtheorem{defprop}[defin]{Def-prop}
	\newtheorem{algo}[defin]{Algorithme}
	\newtheorem{rappel}[defin]{Rappel}
	\newtheorem{methode}[defin]{Méthode}
	\newtheorem{caspart}[defin]{Cas particulier}
	\newtheorem{casparts}[defin]{Cas particuliers}
	\newframedtheorem{thmframed}[defin]{Théorème}
	\newframedtheorem{exframed}[defin]{Exemple}
	
	\newenvironment{enonce}[1]{
	\newtheorem{enonce\thecompteurenonce}[defin]{#1}
	\begin{enonce\thecompteurenonce}}
	{\end{enonce\thecompteurenonce} \refstepcounter{compteurenonce}}
	
	\newcommand{\saut}{\
	
	}
	
	\NewDocumentEnvironment{rems}{ob}{\rem{#2}}{\par}
	
\fi

\ifoptioneleve
	
	\RenewDocumentEnvironment{programme}{b}{}{\par}
	\RenewDocumentEnvironment{deroule}{b}{}{\par}

	\RenewDocumentEnvironment{rems}{ob}{\ifthenelse{\equal{#1}{eleve}}{\begin{remsbase}#2\end{remsbase}}}{\par}

	\renewcommand{\rem}[2][]{\ifthenelse{\equal{#1}{eleve}}{\rembase{#2}}{}}
	
	% Commande progres pour arrêter la compilation (uniquement pour les élèves)	
	
	\renewcommand{\progres}{\end{document}}

\fi

\ifoptionminted

	
	\RequirePackage[cachedir=\detokenize{_}minted]{minted}
	\usemintedstyle{rainbow_dash} % Styles sympa: default,manni,monokai,pastie,native,igor,lovelace,rainbow_dash,inkpot,
	\setminted{xleftmargin=\parindent,linenos,
    	gobble=0,
    	breaklines=true,
    	breakafter=,,
    	tabsize=4,
    	numbersep=8pt}
	
\fi

	

%%% Ajout option élève
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\begin{comment}
\newcounter{compteurexostcb}

\newcommand{\deftcbUnExoTest}[6][10]{
\definecolor{#2-titre}{Hsb}{#4,#5,#6}
\colorlet{#2}{#2-titre!#1}
\newtcolorbox{#2}[1][]{
	colback=#2,
	title={},
	colbacktitle=#2,
	top=0pt,
	breakable,
	bottom=4pt,
	left=4pt,
	right=4pt,
	enlarge bottom by=0pt,
	%borderline west={1pt}{0pt}{#2-titre},
	before upper={\stepcounter{compteurexostcb}\colorlet{bg}{#2} \definecolor{bfcolor}{Hsb}{#4,0.75,0.15} \hspace{-4pt}\tcbox[arc=0pt,boxrule=0pt,outer arc=0pt,enlarge bottom by=0pt,enhanced jigsaw,tcbox raise base,after={},before={},top=0pt,bottom=1pt,right=0mm,left=5pt,colback=#2-titre]{\color{white}\bfseries\MakeUppercase{#3}\ifstrempty{##1}{}{ (##1)} \thecompteurexostcb :}\ },
	after upper={\colorlet{bg}{white} \colorlet{bfcolor}{black}},
	%before upper={\tcolorboxsubtitle{#1}{##1}},
}
}

\deftcbUn{exotcbbase}{Exercice \thecompteurexostcb}{30}{0.8}{0.75} % Ne pas utiliser, compteur pas incrémenté ( utiliser exercice)

%\newenvironment{exercice}[1][]{\stepcounter{compteurexostcb}\begin{exotcbbase}[#1]}{\end{exotcbbase}}
\end{comment}
